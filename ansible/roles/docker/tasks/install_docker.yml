---
# Install Docker (Debian) or Podman (RedHat)

# Debian/Ubuntu - use get.docker.com convenience script
- name: Download Docker if not already installed (Debian)
  become: true
  ansible.builtin.shell: |
    curl -fsSL https://get.docker.com -o - | bash
  args:
    executable: /bin/bash
    creates: /usr/bin/docker
  when: ansible_facts['os_family'] == "Debian"

- name: Add docker group (Debian)
  become: true
  ansible.builtin.group:
    name: docker
    state: present
  when: ansible_facts['os_family'] == "Debian"

- name: Add user to docker group (Debian)
  become: true
  ansible.builtin.user:
    name: "{{ ansible_facts['user_id'] }}"
    groups: docker
    append: yes
  when: ansible_facts['os_family'] == "Debian"

# RedHat/Rocky - use Podman (native container runtime)
- name: Install Podman (RedHat)
  become: true
  ansible.builtin.dnf:
    name:
      - podman
      - podman-docker
      - buildah
      - skopeo
    state: present
  when: ansible_facts['os_family'] == "RedHat"
